<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Strava Connected</title>
</head>

<body>
  <h1 id="status">Processing...</h1>

  <script>
    async function sendCodeToN8n() {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");

      if (!code) {
        document.getElementById("status").textContent =
          "Error: Missing authorization code";
        return;
      }

      try {
        const response = await fetch(
          "https://n8n.yourdomain.com/webhook/strava-callback",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code }),
          }
        );

        if (response.ok) {
          document.getElementById("status").textContent =
            "✅ Strava connected successfully!";
        } else {
          document.getElementById("status").textContent =
            "❌ Connection failed. Please try again.";
        }
      } catch (error) {
        document.getElementById("status").textContent =
          "❌ Network error. Please try again.";
      }
    }

    sendCodeToN8n();
  </script>
</body>

</html>